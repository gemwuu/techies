{"version":3,"sources":["src/util.js","src/dom.js","index.js"],"names":["attrs","Map","type","value","Object","prototype","toString","call","match","toLowerCase","removeWhiteSpace","array","dirtyData","filter","item","includes","getNumbers","str","getSelector","node","indexOf","console","warn","selector","unshift","getParentSelector","parentElement","join","parent","siblings","children","tagName","length","addAttr","getChildIndex","Array","getClassName","getId","className","attributes","class","replace","index","has","get","set","id","numbers","selectors","techies","dom","recursive","info","JSON","stringify","slice","el","firstChild","nodeType","number","data","parentNode","forEach","i","push","nextSibling","traverse","window","Traverse"],"mappings":"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","file":"index.js","sourceRoot":"..","sourcesContent":["// 同一个 class 或 id，出现多次需要手动加索引\nconst attrs = new Map();\n\n// 获取当前节点的类型\nexport function type(value) {\n  return Object.prototype.toString\n    .call(value)\n    .match(/\\[object\\ (.*)\\]/)[1]\n    .toLowerCase();\n}\n\n// 去掉节点里面的脏数据\nexport function removeWhiteSpace(array) {\n  const dirtyData = ['', ' '];\n  return array.filter(item => !dirtyData.includes(item));\n}\n\n// 匹配小数和整数，带符号\nexport function getNumbers(str) {\n  return str.match(/([+-]?[0-9]{1,}[.][0-9]*)|[+-]?[0-9]{1,}/g);\n}\n\n// 获取当前节点基于选择器的唯一标识符\nexport function getSelector(node) {\n  // 非 dom 节点\n  if (type(node).indexOf('html') < 0) {\n    console.warn(`[techies] error dom type: ${type(node)}, need html element.`);\n    return '';\n  }\n\n  if (type(node) === 'htmlhtmlelement') {\n    return 'html';\n  }\n\n  if (type(node) === 'htmlbodyelement') {\n    return 'body';\n  }\n\n  let selector = [];\n  let _node;\n\n  while (type(node) !== 'htmlbodyelement') {\n    selector.unshift(getParentSelector(node));\n    _node = node;\n    node = node.parentElement;\n  }\n\n  return `body${selector.join('')}`;\n}\n\n// 获取父节点的选择器\nfunction getParentSelector(node) {\n  const parent = node.parentElement;\n  const siblings = parent.children;\n  const tagName = node.tagName.toLowerCase();\n\n  if (siblings && siblings.length === 1) {\n    return `>${tagName}${addAttr(node)}`;\n  } else {\n    return `>${getChildIndex(node)}`;\n  }\n}\n\n// 获取当前节点在父节点中的索引\nexport function getChildIndex(node) {\n  const parent = node.parentElement;\n  const siblings = parent.children;\n  const tagName = node.tagName.toLowerCase();\n\n  return `${tagName}${addAttr(node)}:nth-child(${Array.prototype.indexOf.call(siblings, node) + 1})`;\n}\n\n// 将当前节点的 class 和 id 都加到选择器中\nfunction addAttr(node) {\n  return `${getClassName(node)}${getId(node)}`;\n}\n\nfunction getClassName(node) {\n  let className = node.attributes.class ? `.${node.attributes.class.value.replace(' ', '.')}` : '';\n  if (className) {\n    let index = 0;\n    if (attrs.has(className)) {\n      index = attrs.get(className) + 1;\n    }\n    attrs.set(className, index);\n    className = `${className}-${index}`;\n  }\n\n  return className;\n}\n\nfunction getId(node) {\n  let id = node.attributes.id ? `#${node.attributes.id.value}` : '';\n  if (id) {\n    let index = 0;\n    if (attrs.has(id)) {\n      index = attrs.get(id) + 1;\n    }\n    attrs.set(id, index);\n    id = `${id}-${index}`;\n  }\n\n  return id;\n}\n","import {\n  type,\n  removeWhiteSpace,\n  getNumbers,\n  getSelector,\n} from './util';\n\n// 数据集合\nlet numbers = [];\n\n// 选择器集合，一个节点有多个 TEXT_NODE 需要手动加索引\nconst selectors = new Map();\n\nexport default function techies(dom) {\n  if (type(dom) !== 'htmlbodyelement') {\n    console.warn(`[techies] error dom type: ${type(dom)}, need body element, techies will exit doing nothing.`);\n    return;\n  }\n\n  recursive(dom);\n  console.info(`[reportData]${JSON.stringify(removeWhiteSpace(numbers.slice(0, 15)))}`);\n  numbers = [];\n}\n\n// 递归遍历特定节点\nfunction recursive(node) {\n  let el = node.firstChild;\n\n  while (el) {\n    // ELEMENT_NODE\n    if (el.nodeType === 1) {\n      recursive(el);\n    // TEXT_NODE\n    } else if (el.nodeType === 3) {\n      const number = getNumbers(el.data);\n      // 此处根据是否是数字判断是否继续进行后续处理\n      if (number) {\n        const selector = getSelector(el.parentNode);\n        // 如果 selector 不重复\n        if (!selectors.has(selector)) {\n          number.forEach((item, index) => {\n            numbers.push({\n              selector: `${selector}-${index}`,\n              number: item,\n            });\n          });\n          selectors.set(selector, number.length);\n        // 如果 selector 重复，手动增加索引\n        } else {\n          const index = selectors.get(selector);\n          number.forEach((item, i) => {\n            numbers.push({\n              selector: `${selector}-${i + index}`,\n              number: item,\n            });\n          });\n          selectors.set(selector, index + number.length);\n        }\n      }\n    }\n    const nextSibling = el.nextSibling;\n    el = nextSibling;\n  }\n}\n","import traverse from './src/dom';\n\nwindow.Traverse = traverse;\n// traverse(document.body);\nexport default traverse;\n"]}